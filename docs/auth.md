# Authentication

## Overview

The app uses a context-based authentication system. In development, the mock server accepts any credentials and returns a predefined user. In production (v1), authentication is handled via JWT with the [REST API server](https://github.com/Carloslt5/task-manager-server).

## Auth Context

Source: `src/app/features/auth/auth.context.tsx`

The `AuthProvider` manages user state:

- **Storage**: User object is persisted in `localStorage` under the key `"auth_user"`
- **`login(user)`**: Saves user to localStorage and updates state
- **`logout()`**: Removes user from localStorage and clears state
- **`useAuthContext()`**: Hook to access `user`, `login`, and `logout`

On app load, the stored user is read from localStorage to restore the session.

## Login Flow

```text
SignInPage
  → useLogin hook (react-hook-form + useMutation)
    → POST /api/auth/login
    → onSuccess: authContext.login(user) + navigate to /admin/dashboard
```

### useLogin Hook

Source: `src/app/features/auth/hooks/useLogin.ts`

- Uses `react-hook-form` to manage email/password form state
- Uses `useMutation` from React Query to call the login service
- On success, stores the user via `AuthContext.login()` and redirects to `/admin/dashboard`

## Routes

Registered in `src/app/features/auth/index.tsx`:

| Path     | Component             |
| -------- | --------------------- |
| `/`      | Redirects to `/login` |
| `/login` | `SignInPage`          |

## Mock Handler

Source: `src/app/features/auth/auth.mocks.handlers.ts`

The mock login endpoint accepts any credentials and returns a predefined user (generated by `UserMother`):

```typescript
http.post("/api/auth/login", async () => {
  await delay(500);
  return HttpResponse.json({ data: userData });
});
```

## Roles and Permissions

Defined in `src/app/features/auth/auth.types.ts`:

```typescript
enum UserRoles {
  ADMIN = "admin",
  STAFF = "staff",
}
```

Menu items use `isAllowed(user)` callbacks to filter visibility based on user roles. See [Architecture](architecture.md) for details on the module system.
